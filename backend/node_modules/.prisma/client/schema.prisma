generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String      @id @default(uuid())
  email             String      @unique
  password          String
  name              String
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  role              UserRole    @default(STUDENT)
  instructorProfile Instructor?
  studentProfile    Student?

  @@map("users")
}

model Instructor {
  id                 String             @id @default(uuid())
  userId             String             @unique
  cpf                String             @unique
  credentialNumber   String
  bio                String?
  phone              String
  avatarUrl          String?
  latitude           Float?
  longitude          Float?
  address            String?
  pricePerHour       Decimal            @db.Decimal(10, 2)
  categories         String[]
  verificationStatus VerificationStatus @default(NOT_SUBMITTED)
  rejectionReason    String?
  rejectionNotes     String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  user               User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  lessons            Lesson[]
  vehicles           Vehicle[]

  @@map("instructors")
}

model Student {
  id        String   @id @default(uuid())
  userId    String   @unique
  cpf       String   @unique
  phone     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lessons   Lesson[]
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("students")
}

model Vehicle {
  id           String           @id @default(uuid())
  instructorId String
  model        String
  brand        String
  year         Int
  plate        String           @unique
  transmission TransmissionType
  isAdapted    Boolean          @default(true)
  instructor   Instructor       @relation(fields: [instructorId], references: [id])

  @@map("vehicles")
}

model Lesson {
  id           String       @id @default(uuid())
  studentId    String
  instructorId String
  scheduledAt  DateTime
  duration     Int
  status       LessonStatus @default(PENDING)
  notes        String?
  createdAt    DateTime     @default(now())
  instructor   Instructor   @relation(fields: [instructorId], references: [id])
  student      Student      @relation(fields: [studentId], references: [id])

  @@map("lessons")
}

enum UserRole {
  ADMIN
  INSTRUCTOR
  STUDENT
}

enum TransmissionType {
  MANUAL
  AUTOMATIC
}

enum LessonStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELED
}

enum VerificationStatus {
  NOT_SUBMITTED
  PENDING
  APPROVED
  REJECTED
}
