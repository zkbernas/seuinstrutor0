generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Tabela Base de Usuários (Login e Senha)
model User {
  id        String   @id @default(uuid()) // ID único universal
  email     String   @unique
  password  String // A senha será criptografada (hash)
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  role      UserRole @default(STUDENT) // Define se é Aluno ou Instrutor

  // Relacionamentos (Um usuário pode ser um Instrutor OU um Aluno)
  instructorProfile Instructor?
  studentProfile    Student?

  @@map("users") // Nome real da tabela no banco
}

// 2. Perfil do Instrutor
model Instructor {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  cpf              String  @unique
  credenicalNumber String // Número da credencial do DETRAN
  bio              String? // Pequena biografia
  phone            String
  avatarUrl        String? // Foto do perfil

  // Dados de localização simples (para começar)
  latitude  Float?
  longitude Float?
  address   String?

  pricePerHour Decimal  @db.Decimal(10, 2)
  categories   String[] // Ex: ["A", "B"] (Carro e Moto)

  vehicles Vehicle[]
  lessons  Lesson[]

  @@map("instructors")
}

// 3. Perfil do Aluno
model Student {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  cpf   String @unique
  phone String

  lessons Lesson[]

  @@map("students")
}

// 4. Veículos do Instrutor
model Vehicle {
  id           String     @id @default(uuid())
  instructorId String
  instructor   Instructor @relation(fields: [instructorId], references: [id])

  model        String // Ex: Gol, Onix
  brand        String // Ex: VW, Chevrolet
  year         Int
  plate        String           @unique
  transmission TransmissionType // Manual ou Automático
  isAdapted    Boolean          @default(true) // Se tem duplo comando

  @@map("vehicles")
}

// 5. Agendamentos / Aulas
model Lesson {
  id String @id @default(uuid())

  studentId String
  student   Student @relation(fields: [studentId], references: [id])

  instructorId String
  instructor   Instructor @relation(fields: [instructorId], references: [id])

  scheduledAt DateTime // Data e hora da aula
  duration    Int // Duração em minutos (ex: 50, 100)
  status      LessonStatus @default(PENDING)

  notes String? // Anotações sobre a aula

  createdAt DateTime @default(now())

  @@map("lessons")
}

// --- ENUMS (Opções fixas) ---

enum UserRole {
  ADMIN
  INSTRUCTOR
  STUDENT
}

enum TransmissionType {
  MANUAL
  AUTOMATIC
}

enum LessonStatus {
  PENDING // Aguardando confirmação do instrutor
  CONFIRMED // Confirmada
  COMPLETED // Aula realizada
  CANCELED // Cancelada
}
